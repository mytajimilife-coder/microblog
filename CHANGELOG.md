# Microblog - 更新履歴

## バージョン 1.8.0 (2026-01-04) - 管理画面からのテーマ管理

### 🎉 新機能

#### 1. 管理画面テーマ設定 (Admin Theme Settings)
- 管理者パネルからクリック一つでテーマを切り替え可能
- `sleek` (洗練されたデザイン) と `cute` (かわいいデザイン) に対応
- 現在使用中のテーマを一目で確認可能

#### 2. 動的テーマエンジン
- テルマ設定をデータベースに保存
- サイト訪問時に最新の設定をキャッシュから読み込み、リアルタイムに適用
- 하드코딩된 설정 없이 유연한 테마 변경 지원

### 📁 新規ファイル
- `admin/themes.php`: テーマ選択用管理画面

---

## バージョン 1.7.0 (2026-01-04) - セキュリティと執筆体験の向上

### 🎉 新機能

#### 1. Markdown サポート (Markdown Processor)
- 軽量な Markdown パーサーを内蔵
- タイトル、太字、リンク、引用、コードブロックのレンダリングに対応
- 執筆効率の向上

#### 2. IP アクセス制御 (IP Firewall)
- 不審な IP アドレスを個別にブロック・解除可能
- 期限付きブロック（自動解除）に対応
- 全域的なアクセスセキュリティの強化

#### 3. 自動目次生成 (TOC Generator)
- 投稿内の見出し (H2-H4) から自動的に目次を生成
- ページ内アンカーリンクの自動付与
- ユーザビリティと SEO の向上

### 🛠️ データベース変更
- `ip_bans` テーブルの追加（アクセス制限管理用）

### 📁 新規ファイル
```
includes/
├── security/
│   └── ip_manager.php      # IP制限管理
├── markdown_processor.php  # Markdown変換
└── toc_generator.php       # 目次自動生成
```

---

## バージョン 1.6.0 (2026-01-04) - 写稿 API と認証の強化

### 🎉 新機能

#### 1. 投稿作成 API (POST /api.php?action=posts)
- 外部アプリケーションからの記事投稿に対応
- JSON ペイロードおよびフォームデータの両方をサポート
- タイトル、本文、抜粋、ステータス（下書き/公開）の指定が可能

#### 2. API キーとユーザーの紐付け
- `api_keys` テーブルに `user_id` カラムを追加
- API 経由で投稿された記事の作成者を自動的に特定
- 認証のセキュリティ向上

#### 3. 自動スラッグ生成
- API 投稿時、タイトルから URL 親和的なスラッグを自動生成
- 重複するスラッグがある場合の衝突回避機能

### 🛠️ データベース変更
- `api_keys` テーブルに `user_id` (INT) を追加し、インデックスを設定

---

## バージョン 1.5.0 (2026-01-04) - REST API システム

### 🎉 新機能

#### 1. REST API エントリポイント
- `api.php` を通じた外部連携機能
- JSON 形式による標準的なデータレスポンス
- 게시글 목록, 상세, 검색, 통계 데이터 제공

#### 2. API キー認証
- 安全な外部アクセスを保証する API キー管理
- ヘッダー (`X-API-KEY`) または クエリパラメータによる認証に対応
- API キーごとの最終利用日時トレース

#### 3. API コントローラー
- ページネーション対応の投稿一覧取得
- 閲覧数カウント連動の投稿詳細取得
- 高速な全文検索 API

### 📁 新規ファイル

```
api.php                     # API エントリポイント
includes/
├── api_manager.php         # API 認証・管理
└── controllers/
    └── api_controller.php  # API ビジネスロジック
```

---

## バージョン 1.4.0 (2026-01-04) - プロフェッショナル運用機能

### 🎉 新機能

#### 1. パンくずリスト (Breadcrumbs)
- SEOに最適化されたJSON-LD構造化データ出力
- カテゴリー・投稿の階層表示
- カスタマイズ可能なデザイン（CSS同梱）

#### 2. 投稿メタデータ (カスタムフィールド)
- 投稿ごとに独自の情報を追加可能（外部URL、ビデオID、追加設定など）
- PHPの直列化(Serialize)による複雑なデータ保存に対応
- MySQL/PostgreSQL両対応

#### 3. 権限管理の厳格化 (RBAC)
- 権限（Capability）ベースのアクセス制御
- 管理者、編集者、投稿者ごとの詳細な操作制限
- 「自分の記事のみ編集可能」などの動的権限チェック

### 📁 新規ファイル

```
includes/
├── breadcrumb.php          # パンくずリスト
├── post_meta.php           # カスタムフィールド
└── access_control.php      # 権限管理
```

---

## バージョン 1.3.0 (2026-01-04) - 拡張性と管理機能の強化

### 🎉 新機能

#### 1. フック・プラグインシステム
- アクション(Action)とフィルター(Filter)の導入
- コアファイルを変更せずに機能拡張が可能
- テーマ開発の自由度が向上

#### 2. メンテナンスモード (点検モード)
- サイト全体の一時停止機能
- 管理者のみアクセス可能なバイパス機能
- カスタマイズ可能なメンテナンスページ

#### 3. 管理者通知センター
- ダッシュボードでの未処理事項（未承認コメント、未読メッセージ）の集約表示
- バックアップ推奨アラート機能
- 優先度別の通知管理

#### 4. サイト設定エンジン
- 設定値のキャッシュ機能（DB負荷軽減）
- グローバル設定の取得・保存の共通化

### 📁 新規ファイル

```
includes/
├── hooks.php               # フックシステム
├── site_settings.php       # サイト設定・メンテナンス
└── admin_notifications.php # 通知センター

themes/default/
└── maintenance.php         # メンテナンスページ
```

---

## バージョン 1.2.0 (2026-01-04) - 追加機能

### 🎉 新機能

#### 1. 画像自動最適化
- アップロード時の自動リサイズ
- サムネイル自動生成
- 画質最適化（JPEG品質85%）
- WebP形式サポート
- メモリ効率的な画像処理

#### 2. 統計システム
- 人気記事ランキング（閲覧数順）
- トレンド記事（過去7日間）
- カテゴリー別統計
- タグ別統計
- 月別投稿統計
- 著者別統計
- 全体サマリー

#### 3. ソーシャル共有機能
- Twitter共有ボタン
- Facebook共有ボタン
- LINE共有ボタン
- はてなブックマーク
- Pocket
- URLコピー機能
- レスポンシブデザイン

#### 4. 予約投稿システム
- 未来の日時に自動公開
- 予約投稿管理画面
- Cronジョブ対応
- 予約キャンセル機能
- 予約統計表示

#### 5. 統計ダッシュボード
- 総投稿数・閲覧数・コメント数表示
- 人気記事一覧
- カテゴリー・タグ統計
- 月別グラフ
- 予約投稿情報

### 📊 データベース更新

- `posts`テーブルに`scheduled_publish_at`カラム追加
- `status`に`scheduled`ステータス追加
- 予約投稿用インデックス追加

### 📁 新規ファイル

```
includes/
├── image_processor.php      # 画像処理クラス
├── statistics.php           # 統計クラス
├── social_share.php         # ソーシャル共有
└── scheduled_posts.php      # 予約投稿管理

admin/
└── statistics.php           # 統計ダッシュボード

cron/
└── publish_scheduled.php    # 予約投稿自動公開

logs/                        # ログディレクトリ
```

### 🎯 使用方法

#### 画像アップロード
```php
require_once 'includes/image_processor.php';
$processor = new ImageProcessor();
$result = $processor->uploadAndOptimize($_FILES['image']);
```

#### 統計取得
```php
require_once 'includes/statistics.php';
$stats = new Statistics($pdo);
$popular = $stats->getPopularPosts(10);
```

#### ソーシャル共有ボタン
```php
require_once 'includes/social_share.php';
echo SocialShare::generateButtons($url, $title, $description);
echo SocialShare::getAssets(); // CSS/JS
```

#### 予約投稿
```php
require_once 'includes/scheduled_posts.php';
$scheduler = new ScheduledPosts($pdo);
$scheduler->schedulePost($postData, '2026-01-10 12:00:00');
```

#### Cron設定（予約投稿自動公開）
```bash
# Linux/Mac
*/5 * * * * php /path/to/microblog/cron/publish_scheduled.php

# Windows タスクスケジューラ
# プログラム: C:\php\php.exe
# 引数: D:\mmorpg\microblog\cron\publish_scheduled.php
# トリガー: 5分ごと
```

---

## バージョン 1.1.0 (2026-01-04)

### 🎉 新機能

#### 1. コメントシステム
- 記事へのコメント機能を追加
- ネストされた返信をサポート
- コメント承認制度
- スパムフィルタリング

#### 2. 全文検索機能
- タイトル、本文、抜粋からの検索
- 日本語対応の検索機能
- ページネーション付き検索結果

#### 3. RSSフィード
- 自動RSS 2.0フィード生成
- 最新20件の記事を配信
- 日本語完全対応

#### 4. XMLサイトマップ
- 自動サイトマップ生成
- 記事、カテゴリー、タグを含む
- SEO最適化

#### 5. バックアップ・復元機能
- ワンクリックデータベースバックアップ
- バックアップファイルの管理
- データベース復元機能
- バックアップファイルのダウンロード

#### 6. 権限自動対応
- 書き込み権限がない環境でもインストール可能
- 手動設定ガイドの表示
- ユーザーフレンドリーなエラーハンドリング

### 🌏 国際化

- **完全日本語化**: すべてのインターフェースを日本語に統一
- 中国語表記を日本語に変更
- 日本語専用ブログシステムとして最適化

### 📊 データベース

- コメントテーブルの追加
- MySQL/PostgreSQL両対応
- 適切なインデックス設定

### 🔧 改善

- インストーラーの権限チェック強化
- エラーハンドリングの改善
- セキュリティ設定の追加
- コード品質の向上

### 📁 新規ファイル

```
includes/
├── models/
│   └── comment.php          # コメントモデル
├── controllers/
│   └── search_controller.php # 検索コントローラー
├── backup.php               # バックアップクラス

themes/default/
└── search.php               # 検索結果テンプレート

admin/
└── backup.php               # バックアップ管理画面

backups/                     # バックアップ保存ディレクトリ

rss.php                      # RSSフィード
sitemap.php                  # サイトマップ
```

### 🎯 使用方法

#### 検索機能
```
http://your-domain.com/?action=search&q=検索キーワード
```

#### RSSフィード
```
http://your-domain.com/rss.php
```

#### サイトマップ
```
http://your-domain.com/sitemap.php
```

#### バックアップ管理
```
http://your-domain.com/admin/backup.php
```

### 🔐 セキュリティ

- コメントスパム対策
- IPアドレス記録
- コメント承認制
- XSS/CSRF保護の強化

### 📝 今後の予定

- [ ] メール通知機能
- [ ] ソーシャルメディア連携
- [ ] 画像最適化
- [ ] キャッシュシステム
- [ ] マルチユーザー対応強化

---

## バージョン 1.0.0 (初回リリース)

- 基本的なブログ機能
- 記事管理
- カテゴリー・タグ管理
- ユーザー管理
- テーマシステム
